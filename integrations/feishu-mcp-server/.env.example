# ============================================================
# 组织A - 数据操作 (MCP Server) 自动化服务端配置
# ============================================================
# 飞书数据应用的 App ID
FEISHU_DATA_APP_ID=cli_xxxxxxxxxxxxxxxx
# 飞书数据应用的 App Secret
FEISHU_DATA_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# 飞书的团队/企业专属标识 (例如 your-company)
BITABLE_DOMAIN=your-company
# 多维表格 (Bitable) App Token
BITABLE_APP_TOKEN=appXXXXXXXXXXXXXX
# 定向表格内的具体 Table ID
BITABLE_TABLE_ID=tblXXXXXXXXXXXXXX
# 默认读写视图的 View ID (可选)
BITABLE_VIEW_ID=
# 挂载或创建云文档的宿主文件夹 Token (可选)
DOC_FOLDER_TOKEN=
# 作为团队日程的日历 ID
FEISHU_CALENDAR_ID=
# 日历事件的时区 (默认: Asia/Shanghai)
FEISHU_CALENDAR_TIMEZONE=Asia/Shanghai
# 预约/日历事件的默认持平时长（分钟）
FEISHU_CALENDAR_DEFAULT_DURATION_MINUTES=30

# ============================================================
# MCP 数据层内置的自动化能力
# ============================================================
# 是否在 MCP 层面开启自动化监听与执行体系
AUTOMATION_ENABLED=false
# 飞书事件订阅验证 Token (需与飞书开放平台后台一致)
FEISHU_EVENT_VERIFY_TOKEN=
# 飞书事件订阅消息加密 Key (如关闭加密则留空)
FEISHU_EVENT_ENCRYPT_KEY=
# 自动化执行使用的底层数据与状态落地目录
AUTOMATION_STORAGE_DIR=automation_data
# 描述自动化流引擎的规则控制文件 YAML
AUTOMATION_RULES_FILE=automation_rules.yaml
# 单个自动化事件被保存后清理的生命周期上限 (秒)
AUTOMATION_EVENT_TTL_SECONDS=604800
# 业务端去重记录维持时限 (秒)
AUTOMATION_BUSINESS_TTL_SECONDS=604800
# 指纹级别去重队列的最大累积量
AUTOMATION_MAX_DEDUPE_KEYS=50000

# Bitable 扫表扫描配置
# 主动轮询/扫描时的单次落表分页控制
AUTOMATION_SCAN_PAGE_SIZE=100
# 最大强扫的页数限制防泄漏
AUTOMATION_MAX_SCAN_PAGES=50
# MCP端通过推送事件监听来判决新记录触发
AUTOMATION_TRIGGER_ON_NEW_RECORD_EVENT=false
# MCP端通过主动捞表对比来发现新记录突破
AUTOMATION_TRIGGER_ON_NEW_RECORD_SCAN=true
# 基于检查点 (Checkpoint) 来作为扫描的依据, 避免每次全表重扫
AUTOMATION_TRIGGER_ON_NEW_RECORD_SCAN_REQUIRES_CHECKPOINT=true
# MCP应用上线时的启动行为 (auto恢复等)
AUTOMATION_STARTUP_MODE=auto
# 在新记录扫描时, 每回合允许被触发的上限条数防炸群
AUTOMATION_NEW_RECORD_SCAN_MAX_TRIGGER_PER_RUN=50

# 被删记录的同步与反向处理策略
# 是否将 Bitable 上的删除事件流向消费端同步
AUTOMATION_SYNC_DELETIONS_ENABLED=true
# 单次处理的最大删除消息广播量
AUTOMATION_SYNC_DELETIONS_MAX_PER_RUN=200

# 轮询探测调度服务
# 是否硬性依赖内部定时轮询
AUTOMATION_POLLER_ENABLED=false
# 定时轮询器探测频差 (秒)
AUTOMATION_POLLER_INTERVAL_SECONDS=60
# 自动化动作执行失败的最大重试次数
AUTOMATION_ACTION_MAX_RETRIES=1
# 重试自动化动作退避休眠时段 (秒)
AUTOMATION_ACTION_RETRY_DELAY_SECONDS=0.5

# 自动化状态流日志追踪
# 解析排错丢弃的消息死信队列
AUTOMATION_DEAD_LETTER_FILE=automation_data/dead_letters.jsonl
# 自动化过程的常态流转追踪日志
AUTOMATION_RUN_LOG_FILE=automation_data/run_logs.jsonl
# Delay 队列文件（JSONL）
AUTOMATION_DELAY_QUEUE_FILE=automation_data/delay_queue.jsonl
# Delay 调度器开关
AUTOMATION_DELAY_SCHEDULER_ENABLED=true
# Delay 调度轮询间隔（秒）
AUTOMATION_DELAY_SCHEDULER_INTERVAL_SECONDS=5
# Delay 终态任务保留时长（秒）
AUTOMATION_DELAY_TASK_RETENTION_SECONDS=86400
# Delay 可调度最大延迟（秒，默认30天）
AUTOMATION_DELAY_MAX_SECONDS=2592000
# Cron 队列文件（JSONL）
AUTOMATION_CRON_QUEUE_FILE=automation_data/cron_queue.jsonl
# Cron 调度器开关
AUTOMATION_CRON_SCHEDULER_ENABLED=true
# Cron 调度轮询间隔（秒，默认30秒）
AUTOMATION_CRON_POLL_INTERVAL_SECONDS=30
# Cron 连续失败熔断阈值（达到后自动暂停）
AUTOMATION_CRON_MAX_CONSECUTIVE_FAILURES=3

# ============================================================
# 多维表格表架构结构监听 (Schema watcher)
# ============================================================
# 启用结构刷新与监听功能
AUTOMATION_SCHEMA_SYNC_ENABLED=true
# 基于主动探测表的列结构变更
AUTOMATION_SCHEMA_POLLER_ENABLED=false
# 主动探测列结构的轮询延时 (秒)
AUTOMATION_SCHEMA_SYNC_INTERVAL_SECONDS=300
# 基于外部订阅或指令被动驱动 Schema 变动
AUTOMATION_SCHEMA_SYNC_EVENT_DRIVEN=true
# 内存缓存列定义映射的文件备份
AUTOMATION_SCHEMA_CACHE_FILE=automation_data/schema_cache.json
# 保存 Schema 元数据流运行状态信息
AUTOMATION_SCHEMA_RUNTIME_STATE_FILE=automation_data/schema_runtime_state.json

# Webhook 反射驱动
# 让外面对 MCP 通知 Schema 更新
AUTOMATION_SCHEMA_WEBHOOK_ENABLED=false
# Webhook的登记地址
AUTOMATION_SCHEMA_WEBHOOK_URL=
# 保护 Webhook 的握手签名密钥
AUTOMATION_SCHEMA_WEBHOOK_SECRET=
# Webhook回调超限
AUTOMATION_SCHEMA_WEBHOOK_TIMEOUT_SECONDS=5
# 开启通过发假请求模拟环境配置测试演练功能
AUTOMATION_SCHEMA_WEBHOOK_DRILL_ENABLED=false

# Field(字段) 变动应对策略
# 飞书表增加新字段的应对: auto_map_if_same_name 等
AUTOMATION_SCHEMA_POLICY_ON_FIELD_ADDED=auto_map_if_same_name
# 飞书表删除字段的应对: auto_remove / keep_and_warn
AUTOMATION_SCHEMA_POLICY_ON_FIELD_REMOVED=auto_remove
# 飞书表命名字段发生的变故: warn_only / force_sync
AUTOMATION_SCHEMA_POLICY_ON_FIELD_RENAMED=warn_only
# 飞书表字段底座类型被强修: warn_only / strict_abort
AUTOMATION_SCHEMA_POLICY_ON_FIELD_TYPE_CHANGED=warn_only
# 作为触发器的依赖列被拆除的动作: disable_rule / bypass
AUTOMATION_SCHEMA_POLICY_ON_TRIGGER_FIELD_REMOVED=disable_rule

# ============================================================
# 第三方 Http Webhook 服务拓展入口配置
# ============================================================
AUTOMATION_WEBHOOK_ENABLED=false
AUTOMATION_WEBHOOK_API_KEY=
AUTOMATION_WEBHOOK_SIGNATURE_SECRET=
# 加密签名里的时间戳容忍滑窗边界 (秒)
AUTOMATION_WEBHOOK_TIMESTAMP_TOLERANCE_SECONDS=300
# 接收或发送网络Hook包的局域网允许域名/IP段管控 (空即开放)
AUTOMATION_HTTP_ALLOWED_DOMAINS=
# 三方 Hook 打出的网络连接超时
AUTOMATION_HTTP_TIMEOUT_SECONDS=10

# Bitable 行回写反馈能力
# 自动化执行后是否向该行所在列更新一条成功/处理状态信息
AUTOMATION_STATUS_WRITE_ENABLED=false
# 定义该反馈的目标栏（多表必须保持统一列名或关闭此项）
AUTOMATION_STATUS_FIELD=自动化_执行状态
# 追踪最近告警内容的预置列
AUTOMATION_ERROR_FIELD=自动化_最近错误
