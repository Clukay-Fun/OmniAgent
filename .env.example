# ============================================================
# OmniAgent 统一变量参考（合并版）
# ============================================================
# 说明：
# - 当前仓库推荐使用子服务独立 .env：
#   - mcp/mcp-feishu-server/.env
#   - agent/feishu-agent/.env
# - 本文件用于统一收集变量项，方便复制到对应子服务 .env
# ============================================================

# ------------------------------------------------------------
# 组织A（数据侧，MCP）- 用于访问和操作飞书多维表格数据
# ------------------------------------------------------------
# 飞书数据应用的 App ID
FEISHU_DATA_APP_ID=cli_xxxxxxxxxxxxxxxx
# 飞书数据应用的 App Secret
FEISHU_DATA_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# 企业飞书域名或特定标识 (如 your-company)
BITABLE_DOMAIN=your-company
# 目标多维表格(Bitable)的 App Token
BITABLE_APP_TOKEN=appXXXXXXXXXXXXXX
# 目标多维表格的具体数据表 ID
BITABLE_TABLE_ID=tblXXXXXXXXXXXXXX
# 目标多维表格的默认视图 ID (可选)
BITABLE_VIEW_ID=
# 飞书云文档知识库所属的文件夹 Token (可选)
DOC_FOLDER_TOKEN=

# ------------------------------------------------------------
# MCP 自动化配置 (schema watcher & webhook)
# ------------------------------------------------------------
# 是否启用全局自动化引擎
AUTOMATION_ENABLED=true
# 飞书事件订阅的 Verification Token
FEISHU_EVENT_VERIFY_TOKEN=
# 飞书事件订阅的 Encrypt Key (如有加密)
FEISHU_EVENT_ENCRYPT_KEY=
# 是否启用主动轮询机制
AUTOMATION_POLLER_ENABLED=false
# Cron 调度器开关（MCP）
AUTOMATION_CRON_SCHEDULER_ENABLED=true
# Cron 轮询间隔（秒）
AUTOMATION_CRON_POLL_INTERVAL_SECONDS=30
# Cron 连续失败自动暂停阈值
AUTOMATION_CRON_MAX_CONSECUTIVE_FAILURES=3
# 是否在收到飞书新建记录事件时触发自动化
AUTOMATION_TRIGGER_ON_NEW_RECORD_EVENT=true
# 是否在扫描发现新记录时触发自动化
AUTOMATION_TRIGGER_ON_NEW_RECORD_SCAN=true
# 扫描触发是否依赖于有效的 Checkpoint 记录
AUTOMATION_TRIGGER_ON_NEW_RECORD_SCAN_REQUIRES_CHECKPOINT=true
# 自动化引擎启动模式 (auto, force_first_run, force_resume)
AUTOMATION_STARTUP_MODE=auto
# 是否同步被删除的记录
AUTOMATION_SYNC_DELETIONS_ENABLED=true
# 每次运行同步删除记录的最大数量
AUTOMATION_SYNC_DELETIONS_MAX_PER_RUN=200
# 是否启用多维表格 Schema 同步机制
AUTOMATION_SCHEMA_SYNC_ENABLED=true
# 是否启用 Schema 轮询同步
AUTOMATION_SCHEMA_POLLER_ENABLED=false
# Schema 同步的时间间隔（秒）
AUTOMATION_SCHEMA_SYNC_INTERVAL_SECONDS=300
# 是否通过事件驱动（Webhook触发）同步 Schema
AUTOMATION_SCHEMA_SYNC_EVENT_DRIVEN=true
# 是否对外提供 Schema Webhook 接口
AUTOMATION_SCHEMA_WEBHOOK_ENABLED=true
# 注册到飞书开放平台的 Schema Webhook URL
AUTOMATION_SCHEMA_WEBHOOK_URL=
# 保护 Schema Webhook 接口的安全密钥
AUTOMATION_SCHEMA_WEBHOOK_SECRET=
# 是否允许通过 Webhook 触发风险演练(Drill)
AUTOMATION_SCHEMA_WEBHOOK_DRILL_ENABLED=false

# ------------------------------------------------------------
# 组织B（机器人侧，Agent）- 用于自然语言交互
# ------------------------------------------------------------
# 飞书机器人应用的 App ID
FEISHU_BOT_APP_ID=cli_xxxxxxxxxxxxxxxx
# 飞书机器人应用的 App Secret
FEISHU_BOT_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# 跨组织（组织B）的备用 App ID (如有)
FEISHU_BOT_ORG_B_APP_ID=
# 跨组织（组织B）的备用 App Secret (如有)
FEISHU_BOT_ORG_B_APP_SECRET=
# 飞书机器人的事件验证 Token
FEISHU_BOT_VERIFICATION_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# 飞书机器人的事件加密 Key
FEISHU_BOT_ENCRYPT_KEY=

# ------------------------------------------------------------
# LLM 模型配置
# ------------------------------------------------------------
# 主 LLM 接口的 API Key
LLM_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# 当前默认使用的 LLM 模型名称
LLM_MODEL=internlm/internlm2_5-7b-chat
# 主力模型标识串 (A/B 分流用)
MODEL_PRIMARY=
# 备用模型标识串 (A/B 分流用)
MODEL_SECONDARY=
# LLM 接口的自定义 Base URL (例如本地部署模型时使用)
LLM_API_BASE=
# 备用 LLM 接口的 API Key（容灾时使用）
LLM_FALLBACK_API_KEY=

# ------------------------------------------------------------
# Agent -> MCP 连接与高级特性
# ------------------------------------------------------------
# MCP Server 的访问地址
MCP_SERVER_BASE=http://localhost:8081
# 是否启用日程提醒的调度器
REMINDER_SCHEDULER_ENABLED=false
# 是否启用飞书富文本卡片渲染
CARD_ENABLED=true
# 是否启用飞书 Emoji Reaction 作为状态反馈 (正在处理、搜索中)
REACTION_ENABLED=true
# 是否启用 query.list.v2 查询卡片（标题+摘要+按钮）
QUERY_CARD_V2_ENABLED=true
# 是否启用轻量回复个性化包装（语气/长度）
REPLY_PERSONALIZATION_ENABLED=false
# 卡片预览默认接收者（run_dev.py card-preview 使用）
FEISHU_PREVIEW_RECEIVE_ID=
# 取值: chat_id/open_id/user_id
FEISHU_PREVIEW_RECEIVE_ID_TYPE=chat_id
# 发送给“我”模式（--send-to-me）默认读取
FEISHU_PREVIEW_OPEN_ID=
# 是否启用防抖分块消息聚合器（合并用户连续短句）
CHUNK_ASSEMBLER_ENABLED=true
# 消息聚合器的防抖等待窗口时长（秒）
CHUNK_ASSEMBLER_STALE_WINDOW_SECONDS=10
# 是否在 Agent 端代理自动化能力
AUTOMATION_ENABLED=true
# 是否开启空跑模式 (仅打印日志，不实际写入/发送)
AUTOMATION_DRY_RUN=true
# 自定义自动化规则文件路径 (可选)
AUTOMATION_RULES_FILE=
# 自动化死信队列落地文件路径 (可选)
AUTOMATION_DEAD_LETTER_FILE=
# 是否允许自动化脚本向平台回写状态
AUTOMATION_STATUS_WRITE_ENABLED=false
# 是否允许 CRUD 操作中的 Delete 删除动作
CRUD_DELETE_ENABLED=false
# 是否启用周期性扫描兜底提醒
REMINDER_SCAN_ENABLED=false
# 兜底扫描间隔（分钟）
REMINDER_SCAN_INTERVAL_MINUTES=60
# 是否开启每日定时的摘要播报
DAILY_DIGEST_ENABLED=false
# 每日扫描播报的时间点
DAILY_DIGEST_SCHEDULE=09:00
# 每日播报设定的时区
DAILY_DIGEST_TIMEZONE=Asia/Shanghai

# ------------------------------------------------------------
# 存储与记忆 (StateStore & Memory)
# ------------------------------------------------------------
# 中期记忆数据库的 SQLite 本地文件路径
MIDTERM_MEMORY_SQLITE_PATH=workspace/memory/midterm_memory.sqlite3
# 是否将中期记忆随 Prompt 注入到 LLM 上下文中
MIDTERM_MEMORY_INJECT_TO_LLM=false
# 注入到 LLM 的最近记忆条数上限
MIDTERM_MEMORY_LLM_RECENT_LIMIT=6
# 注入到 LLM 的记忆总字符数上限
MIDTERM_MEMORY_LLM_MAX_CHARS=240
# 对话状态后端选择 (可选: memory, redis)
STATE_STORE_BACKEND=memory
# Redis 完整 DSN 优先 (如有)
STATE_STORE_REDIS_DSN=
# Redis Host 地址
STATE_STORE_REDIS_HOST=localhost
# Redis 端口
STATE_STORE_REDIS_PORT=6379
# Redis DB 索引
STATE_STORE_REDIS_DB=0
# Redis 密码 (可选)
STATE_STORE_REDIS_PASSWORD=
# Redis 会话前缀
STATE_STORE_REDIS_KEY_PREFIX=omniagent:state:
# Redis Socket 超时时间
STATE_STORE_REDIS_SOCKET_TIMEOUT_SECONDS=1.0

# ------------------------------------------------------------
# 单文件处理管道配置 (File Pipeline)
# ------------------------------------------------------------
# 是否启用文件处理 Pipeline
FILE_PIPELINE_ENABLED=false
# 允许处理的文件最大体积 (字节，示例5MB=5242880)
FILE_PIPELINE_MAX_BYTES=5242880
# 文件处理整体超时控制 (秒)
FILE_PIPELINE_TIMEOUT_SECONDS=12
# 是否启用文件流相关监控指标上报
FILE_PIPELINE_METRICS_ENABLED=true

# 文件抽取核心配置 (文本/PDF提取)
# 是否启用文件内容抽取
FILE_EXTRACTOR_ENABLED=false
# 文件抽取 Provider (取值如: mineru, llm, none)
FILE_EXTRACTOR_PROVIDER=none
# 抽取服务的 API 密钥
FILE_EXTRACTOR_API_KEY=
# 抽取服务的 API Base (例如 MinerU 自建地址)
FILE_EXTRACTOR_API_BASE=
# MinerU 服务的具体转换 Path
FILE_EXTRACTOR_MINERU_PATH=/v1/convert
# LLM 流式抽取服务的具体 Path
FILE_EXTRACTOR_LLM_PATH=/v1/document/convert
# 抽取服务鉴权方式 (bearer/x-api-key)
FILE_EXTRACTOR_AUTH_STYLE=bearer
# 抽取服务自定义 API Key Header 名
FILE_EXTRACTOR_API_KEY_HEADER=X-API-Key
# 抽取服务自定义 API Key 前缀
FILE_EXTRACTOR_API_KEY_PREFIX=Bearer 
# 抽取失败时是否 Fail Open（降级忽略）继续链路
FILE_EXTRACTOR_FAIL_OPEN=true

# 文件上下文控制
# 是否将文件内容片段注入至 LLM Prompt
FILE_CONTEXT_INJECTION_ENABLED=false
# 单个文件注入上下文的最大字符限制
FILE_CONTEXT_MAX_CHARS=2000
# 单个文件注入上下文的最大 Token 限制
FILE_CONTEXT_MAX_TOKENS=500

# ------------------------------------------------------------
# 账单/额度监控与 A/B 分流
# ------------------------------------------------------------
# 是否记录 API 调用用量日志
USAGE_LOG_ENABLED=false
# 用量日志落地路径模板 (支持 {date} 变量)
USAGE_LOG_PATH=workspace/usage/usage_log-{date}.jsonl
# 用量日志记错时是否不阻断正常业务流 (Fail Open)
USAGE_LOG_FAIL_OPEN=true
# 本地单价配置表文件路径
USAGE_MODEL_PRICING_PATH=
# 行内 JSON 单价配置直填
USAGE_MODEL_PRICING_JSON=
# 是否启用多模型灰度随机分流
AB_ROUTING_ENABLED=false
# 路由命中 Model A 的概率比 (0.0~1.0)
AB_ROUTING_RATIO=0.0
# 分流使用的内部模型名称 A
AB_ROUTING_MODEL_A=
# 分流使用的内部模型名称 B
AB_ROUTING_MODEL_B=
# 一小时内触发报警的账单阈值 (美元/人民币等单位取决于统计口径)
COST_ALERT_HOURLY_THRESHOLD=5.0
# 一天内触发报警的账单阈值
COST_ALERT_DAILY_THRESHOLD=50.0
# 是否在超支后强制熔断所有 LLM 请求
COST_CIRCUIT_BREAKER_ENABLED=false

# ------------------------------------------------------------
# OCR/图像识别配置 (暂时关闭备查)
# ------------------------------------------------------------
# 是否启用图像 OCR 提取
OCR_ENABLED=false
# OCR 服务 Provider
OCR_PROVIDER=none
# OCR 服务 API Key
OCR_API_KEY=
# OCR 服务 API Base URL
OCR_API_BASE=
# OCR 服务自定义 Endpoint
OCR_API_ENDPOINT=
OCR_MINERU_PATH=/v1/convert
OCR_LLM_PATH=/v1/document/convert
OCR_AUTH_STYLE=bearer
OCR_API_KEY_HEADER=X-API-Key
OCR_API_KEY_PREFIX=Bearer 

# ------------------------------------------------------------
# ASR/语音识别配置 (暂时关闭备查)
# ------------------------------------------------------------
# 是否启用语音识别转文本
ASR_ENABLED=false
# ASR 服务 Provider
ASR_PROVIDER=none
# ASR 服务 API Key
ASR_API_KEY=
# ASR 服务 API Base URL
ASR_API_BASE=
# ASR 服务自定义 Endpoint
ASR_API_ENDPOINT=
ASR_MINERU_PATH=/v1/convert
ASR_LLM_PATH=/v1/document/convert
ASR_AUTH_STYLE=bearer
ASR_API_KEY_HEADER=X-API-Key
ASR_API_KEY_PREFIX=Bearer 

# ------------------------------------------------------------
# PostgreSQL (可选，做重型缓存或历史回查时用)
# ------------------------------------------------------------
# 无 DB 模式（当前默认），连接串配空即禁用
POSTGRES_DSN=

# ------------------------------------------------------------
# 本地开发辅助目录
# ------------------------------------------------------------
# Agent 运行态各种本地 JSONL / DB / 缓存统一入口目录
OMNI_WORKSPACE_ROOT=./agent/feishu-agent/workspace
