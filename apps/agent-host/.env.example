# Feishu Agent 环境变量

# ============================================
# 飞书机器人凭证（组织B） - 负责自然语言交互界面
# ============================================
# 飞书机器人应用的 App ID
FEISHU_BOT_APP_ID=cli_xxxxxxxxxxxxxxxx
# 飞书机器人应用的 App Secret
FEISHU_BOT_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# 跨组织应用的备用 App ID (如适用)
FEISHU_BOT_ORG_B_APP_ID=
# 跨组织应用的备用 App Secret (如适用)
FEISHU_BOT_ORG_B_APP_SECRET=
# 飞书事件请求的 Verification Token (验证请求合法性)
FEISHU_BOT_VERIFICATION_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# 飞书事件请求的 Encrypt Key (如开启加密)
FEISHU_BOT_ENCRYPT_KEY=

# ============================================
# LLM (大语言模型配置) - 支撑意图解析与对话回复
# ============================================
# 默认大模型提服务商 (openai, anthropic, zhipu, deepseek 等)
LLM_PROVIDER=openai
# 当前默认使用的模型名称
LLM_MODEL=
# 主力模型标识串 (A/B 分流用)
MODEL_PRIMARY=
# 备用模型标识串 (A/B 分流用)
MODEL_SECONDARY=
# 主调用的 API Key
LLM_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# 接口的自定义 Base URL (代理加速或本地模型使用)
# 火山引擎 Ark OpenAI 兼容： https://ark.cn-beijing.volces.com/api/coding/v3
# 火山引擎 Ark Anthropic 兼容： https://ark.cn-beijing.volces.com/api/coding
LLM_API_BASE=

# 容灾备用模型（可选）。注意：当前代码路径未必启用自动切换，但建议把配置预留齐。
LLM_FALLBACK_ENABLED=false
LLM_FALLBACK_PROVIDER=openai
LLM_FALLBACK_MODEL=
LLM_FALLBACK_API_KEY=
LLM_FALLBACK_API_BASE=

# 任务模型（可选）- 用于在执行高复杂/后台推导任务时使用独立模型
# 是否单独开启 Task LLM
TASK_LLM_ENABLED=false
# 独立任务模型的名称
TASK_LLM_MODEL=MiniMax-M2.5
# 独立任务模型的 API Key
TASK_LLM_API_KEY=
# 独立任务模型的 Base URL
TASK_LLM_API_BASE=

# ============================================
# Agent -> MCP 连接及 Agent 特性配置
# ============================================
# MCP Server 的网络访问地址 (容器内互通使用 mcp-feishu-server:8081)
MCP_SERVER_BASE=http://mcp-feishu-server:8081
# MCP_SERVER_BASE=http://localhost:8081
# 是否启用飞书富文本卡片渲染
CARD_ENABLED=true
# 是否启用飞书 Emoji Reaction 作为处理状态反馈
REACTION_ENABLED=true
# 是否启用 query.list.v2 查询卡片（标题+摘要+按钮）
QUERY_CARD_V2_ENABLED=true
# 是否启用轻量回复个性化包装（语气/长度）
REPLY_PERSONALIZATION_ENABLED=false
# 卡片预览默认接收者（run_dev.py card-preview 使用）
FEISHU_PREVIEW_RECEIVE_ID=
# 取值: chat_id/open_id/user_id
FEISHU_PREVIEW_RECEIVE_ID_TYPE=chat_id
# 发送给“我”模式（--send-to-me）默认读取
FEISHU_PREVIEW_OPEN_ID=
# 是否启用防抖分块消息聚合器（合并用户连续短句）
CHUNK_ASSEMBLER_ENABLED=true
# 消息聚合器的防抖等待窗口时长（秒）
CHUNK_ASSEMBLER_STALE_WINDOW_SECONDS=10
# 是否在 Agent 端代理并感知自动化（Trigger）能力
AUTOMATION_ENABLED=true
# 是否启用自动化回调通知入口（/notify）
AUTOMATION_NOTIFY_ENABLED=true
# /notify 的鉴权密钥（需与 MCP 的 AUTOMATION_NOTIFY_API_KEY 一致）
AUTOMATION_NOTIFY_API_KEY=
# 是否开启自动化空跑模式 (仅日志，不真实触动)
AUTOMATION_DRY_RUN=true
# 自定义自动化规则文件路径
AUTOMATION_RULES_FILE=
# 自动化死信队列落地文件路径
AUTOMATION_DEAD_LETTER_FILE=
# 是否允许自动化脚本向平台回写状态字段
AUTOMATION_STATUS_WRITE_ENABLED=false
# CRUD 操作中是否允许硬删除 (Delete)
CRUD_DELETE_ENABLED=false
# 兜底扫描间隔（分钟）
REMINDER_SCAN_ENABLED=false
REMINDER_SCAN_INTERVAL_MINUTES=60
# 每日定时扫描播报相关配置
DAILY_DIGEST_ENABLED=false
DAILY_DIGEST_SCHEDULE=09:00
DAILY_DIGEST_TIMEZONE=Asia/Shanghai

# Agent 记忆与状态管理相关
# 中期记忆 SQLite 本地文件路径
MIDTERM_MEMORY_SQLITE_PATH=workspace/memory/midterm_memory.sqlite3
# 是否将中期记忆注入 Prompt 上下文
MIDTERM_MEMORY_INJECT_TO_LLM=false
# 注入到 LLM 的最大条数
MIDTERM_MEMORY_LLM_RECENT_LIMIT=6
# 注入到 LLM 的最大字符数
MIDTERM_MEMORY_LLM_MAX_CHARS=240
# 会话状态持久化后端 (memory, redis)
STATE_STORE_BACKEND=memory
# 完整的 Redis DSN 字符串 (优先读取)
STATE_STORE_REDIS_DSN=
# Redis Host 地址
STATE_STORE_REDIS_HOST=localhost
STATE_STORE_REDIS_PORT=6379
STATE_STORE_REDIS_DB=0
STATE_STORE_REDIS_PASSWORD=
STATE_STORE_REDIS_KEY_PREFIX=omniagent:state:
# Redis Socket 操作超时上限 (秒)
STATE_STORE_REDIS_SOCKET_TIMEOUT_SECONDS=1.0

# 文件处理管道
# 是否开启基于文件/上传的统一管道
FILE_PIPELINE_ENABLED=false
# 管道处理允许的最大文件大小 (字面量)
FILE_PIPELINE_MAX_BYTES=5242880
# 获取/处理文件的超时秒数
FILE_PIPELINE_TIMEOUT_SECONDS=12
# 流监控指标
FILE_PIPELINE_METRICS_ENABLED=true

# 文件解析提取
# 是否启用通过提供商进行文档抽取 (mineru, llm等)
FILE_EXTRACTOR_ENABLED=false
FILE_EXTRACTOR_PROVIDER=none
FILE_EXTRACTOR_API_KEY=
FILE_EXTRACTOR_API_BASE=
FILE_EXTRACTOR_MINERU_PATH=/v1/convert
FILE_EXTRACTOR_LLM_PATH=/v1/document/convert
FILE_EXTRACTOR_AUTH_STYLE=bearer
FILE_EXTRACTOR_API_KEY_HEADER=X-API-Key
FILE_EXTRACTOR_API_KEY_PREFIX=Bearer 
# 提取不成功时是否降级放行 (Fail Open)
FILE_EXTRACTOR_FAIL_OPEN=true

# 文件内容注入配置
FILE_CONTEXT_INJECTION_ENABLED=false
# 单个文件注入上下文的最大字符限制
FILE_CONTEXT_MAX_CHARS=2000
# 超过截断或换算 Token 时的限制
FILE_CONTEXT_MAX_TOKENS=500

# 用量账单分析记录相关
USAGE_LOG_ENABLED=false
# 落地的 JSONL 日志模板途径
USAGE_LOG_PATH=workspace/usage/usage_log-{date}.jsonl
USAGE_LOG_FAIL_OPEN=true
# 模型计费标价参考表
USAGE_MODEL_PRICING_PATH=
USAGE_MODEL_PRICING_JSON=

# Agent A/B 灰度配置与报警控制
AB_ROUTING_ENABLED=false
AB_ROUTING_RATIO=0.0
AB_ROUTING_MODEL_A=
AB_ROUTING_MODEL_B=
COST_ALERT_HOURLY_THRESHOLD=5.0
COST_ALERT_DAILY_THRESHOLD=50.0
COST_CIRCUIT_BREAKER_ENABLED=false

# OCR 及 ASR 附属引擎参数
OCR_ENABLED=false
OCR_PROVIDER=none
OCR_API_KEY=
OCR_API_BASE=
OCR_API_ENDPOINT=
OCR_MINERU_PATH=/v1/convert
OCR_LLM_PATH=/v1/document/convert
OCR_AUTH_STYLE=bearer
OCR_API_KEY_HEADER=X-API-Key
OCR_API_KEY_PREFIX=Bearer 
ASR_ENABLED=false
ASR_PROVIDER=none
ASR_API_KEY=
ASR_API_BASE=
ASR_API_ENDPOINT=
ASR_MINERU_PATH=/v1/convert
ASR_LLM_PATH=/v1/document/convert
ASR_AUTH_STYLE=bearer
ASR_API_KEY_HEADER=X-API-Key
ASR_API_KEY_PREFIX=Bearer 

# ============================================
# 提醒调度 / DB（重型持久化缓存）
# ============================================
# 开启日程内调度提醒
REMINDER_SCHEDULER_ENABLED=false
# 重型关系表库连接池配置（空代表禁用）
POSTGRES_DSN=
POSTGRES_MIN_SIZE=1
POSTGRES_MAX_SIZE=5
POSTGRES_TIMEOUT=10

# ============================================
# 用户身份与缓存（根据表格字段倒排认证身份）
# ============================================
# 对于没建档飞书ID，尝试根据姓名匹配表格记录的主办人信息自动绑定
USER_IDENTITY_AUTO_MATCH=true
# Bitable中寻找身份认证的人员字段名（逗号分隔多个，如"主办律师,协办律师"，顺序匹配直到命中）
USER_IDENTITY_MATCH_FIELD=主办律师
# 用户信息匹配的最低可信度分数参考
USER_IDENTITY_MIN_CONFIDENCE=0.8
# 匹配失败后，是否主动引导人工绑定流程
USER_IDENTITY_PROMPT_BIND_ON_FAIL=true
# 用户内存缓存有效时间 (时)
USER_CACHE_TTL_HOURS=24
# 缓存槽位上限
USER_CACHE_MAX_SIZE=1000

# ============================================
# 运行时目录控制
# ============================================
# Agent 本地的各种运行时数据产物输出根目录
OMNI_WORKSPACE_ROOT=./workspace
# 实例专属 ID (水平扩展或追溯区分用)
OMNI_INSTANCE_ID=
# yaml 主加载配置的具体路径
CONFIG_PATH=config.yaml

# ============================================
# 团队日历交互
# ============================================
# 日历同步的主副日历表 ID
FEISHU_CALENDAR_ID=
FEISHU_TEAM_CALENDAR_ID=

# ============================================
# 垂直业务: 开庭日提醒能力
# ============================================
# 是否打开专有的庭审时间提醒服务
HEARING_REMINDER_ENABLED=true
# 固定接收提醒的群聊 Chat ID
HEARING_REMINDER_CHAT_ID=your_chat_id_here
# 距开庭日的提前提醒天数策略数组（对应: 7天前、3天前、1天前、当天）
HEARING_REMINDER_OFFSETS=7,3,1,0
# 预审触发的扫描推送时效（时:分）
HEARING_REMINDER_SCAN_HOUR=8
HEARING_REMINDER_SCAN_MINUTE=0
