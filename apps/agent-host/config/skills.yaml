# 技能配置（支持热更新）

defaults:
  timeout_seconds: 10

routing:
  mode: "rule"
  llm_selection_timeout: 5.0
  llm_confidence_threshold: 0.6
  shadow_max_pending: 10

default_table_id: "tblDTbRZRB89q8GJ"

skills:
  query:
    timeout_seconds: 25
  create:
    timeout_seconds: 30
  update:
    timeout_seconds: 30
  delete:
    timeout_seconds: 30
  confirm:
    timeout_seconds: 30

intent:
  thresholds:
    direct_execute: 0.5      # 直接执行（降低以支持单关键词命中）
    llm_confirm: 0.3         # 需要 LLM 复核
  llm_timeout: 10            # LLM 超时秒数

planner:
  enabled: true
  confidence_threshold: 0.65
  llm_timeout_seconds: 4
  fast_path_confidence: 0.8
  scenarios_dir: config/scenarios

query:
  keywords:
    - 查
    - 找
    - 搜索
    - 案件
    - 案子
    - 开庭
    - 庭审
    - 当事人
    - 委托人
  time_keywords:
    - 今天
    - 明天
    - 后天
    - 本周
    - 下周
  all_cases_ignore_default_view: true
  display_fields:
    title_left: "委托人"
    title_right: "对方当事人"
    title_suffix: "案由"
    case_no: "案号"
    court: "审理法院"
    stage: "审理程序"
  keyword_fields:
    - "委托人"
    - "对方当事人"
    - "案件分类"
    - "案件状态"
    - "案由"
    - "案号"
    - "项目ID"
    - "项目类型"
    - "审理法院"
    - "主办律师"
    - "协办律师"
    - "审理程序"
    - "进展"
    - "备注"
  all_cases_keywords:
    - 所有案件
    - 全部案件
    - 案件列表
    - 列出案件
    - 所有项目
    - 全部项目
    - 所有案子
    - 全部案子
    - 查全部
  keep_view_keywords:
    - 按视图
    - 当前视图
    - 仅视图
    - 视图内
    - 只看视图
  semantic_resolution:
    enabled: true
    min_confidence: 0.55
    trace_slots: true
  classification_fields:
    - 项目类型
    - 案件分类
  classification_aliases:
    非诉: [非诉, 非诉类型, 非诉案件, 非诉类]
    诉讼: [诉讼, 诉讼类型, 诉讼案件]
    劳动仲裁: [劳动仲裁, 劳动争议仲裁, 仲裁案件]
    执行: [执行案件, 执行, 终本执行]

create:
  keywords:
    - 新增
    - 新建
    - 创建
    - 添加
    - 录入
    - 登记
  required_fields:
    - 委托人
    - 对方当事人
    - 案由
    - 项目类型
    - 案件分类
  field_extract_timeout_seconds: 3
  confirm_phrases:
    - 确认
    - 确认创建
    - 是
    - 是的
    - ok
    - yes
  cancel_phrases:
    - 取消
    - 算了
    - 不用了
    - 不建了
    - 不创建

update:
  keywords:
    - 更新
    - 修改
    - 改
    - 编辑
    - 变更
  field_options:
    案件状态: [进行中, 已结案, 暂停]

delete:
  keywords:
    - 删除
    - 删掉
    - 移除
    - 去掉
  confirm_phrases:
    - 确认删除
    - 确认
    - 是的
    - 是
    - 删除
    - ok
    - yes

summary:
  keywords:
    - 总结
    - 汇总
    - 概括
    - 整理
  default_fields:
    - 案号
    - 案由
    - 当事人
    - 开庭日
    - 主办律师

reminder:
  keywords:
    - 提醒
    - 记得
    - 别忘了
  default_time: "18:00"
  scan_interval_seconds: 60
  lock_timeout_seconds: 300
  calendar:
    enabled: true
    calendar_id: ""
    timezone: "Asia/Shanghai"
    duration_minutes: 30
    tool_create: "feishu.v1.calendar.event.create"
    title_prefix: "提醒："
  priority_keywords:
    high: [紧急, 重要, 马上]
    low: [有空, 方便时]

chitchat:
  allow_llm: true
  whitelist:
    - 你好
    - 早上好
    - 下午好
    - 谢谢
    - 帮助
    - 你能做什么
  sensitive_reject:
    - 能赢吗
    - 判多久
    - 法律建议

chain:
  triggers:
    - pattern: "(查|找).*(总结|汇总)"
      skills: [QuerySkill, SummarySkill]
    - pattern: "(总结|汇总).*(今天|明天|案)"
      skills: [QuerySkill, SummarySkill]
  max_hops: 2

skills_market:
  enabled: true
  local_dir: src/skills_market

multi_table:
  enabled: true
  links:
    - name: case_to_contract
      enabled: true
      parent_tables: ["案件项目总库", "【诉讼案件】"]
      child_table: "合同管理表"
      parent_key: "委托人"
      child_key: "客户名称"
      create_fields:
        委托人: 客户名称
        主办律师: 主办律师
        项目ID: 关联项目
      update_fields:
        委托人: 客户名称
        主办律师: 主办律师
        项目ID: 关联项目
      create_if_missing_on_update: true
      enable_create: true
      enable_update: true
      enable_delete: false
      delete_mode: none  # none / delete

table_aliases:
  # 根据实际表格名称配置别名
  案件项目总库: ["案件", "项目", "总库", "案子", "我的案件", "诉讼"]
  "【诉讼案件】": ["诉讼案件"]
  招投标台账: ["招投标", "投标", "中标"]
  合同管理表: ["合同", "合同信息", "合同台账"]
  关键节点表: ["节点", "关键节点"]
  签约项目台账: ["签约", "签约项目"]
  投标台账: ["投标台账"]

table_recognition:
  confidence_threshold: 0.65
  auto_confirm_threshold: 0.85
  max_candidates: 3
  templates:
    single_candidate: |
      我找到可能的表：**{table_name}**
      是否就是它？回复「是」继续，或告诉我正确的表名。
    multi_candidate: |
      我找到几个可能的表：
      {candidate_list}
      请回复表名确认，或输入其他表名。
    no_match: |
      我不太确定您要查的是哪个表。
      当前可用的表有：{all_tables}
      请告诉我具体表名。

# 每张表的身份归属字段——用于"我的XXX"类查询时的人员匹配
# 列顺序即搜索优先级，任意一列命中即认为是该用户的记录
table_identity_fields:
  案件项目总库:
    fields: [主办律师, 协办律师]
  招投标台账:
    fields: [协办律师]
  合同管理表:
    fields: [主办律师]
  团队成员工作总览（只读）:
    fields: [发起人, 请求协助人]
