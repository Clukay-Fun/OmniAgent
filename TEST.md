# OmniAgent æµ‹è¯•ç”¨ä¾‹

> æœ€åæ›´æ–°ï¼š2026-02-06

---

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡æˆåŠŸå¯åŠ¨ï¼ˆMCP Server + Feishu Agentï¼‰
- [ ] æ‰€æœ‰æŠ€èƒ½å·²æ³¨å†Œ
- [ ] Webhook éªŒç­¾æ­£å¸¸
- [ ] æ¶ˆæ¯å›å¤æ­£å¸¸
- [ ] "æˆ‘çš„æ¡ˆä»¶"æŸ¥è¯¢æ­£ç¡®
- [ ] è¡¨æ ¼åˆ«åè¯†åˆ«æ­£ç¡®
- [ ] é”™è¯¯æç¤ºå‹å¥½æ¸…æ™°

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯• 1ï¼šåŸºç¡€æŸ¥è¯¢

**ç›®çš„**ï¼šéªŒè¯ QuerySkill æ ¸å¿ƒåŠŸèƒ½

**æ“ä½œ**ï¼š
1. åœ¨é£ä¹¦ä¸­å‘é€ï¼š`æŸ¥è¯¢æ¡ˆä»¶`
2. è§‚å¯Ÿæ˜¯å¦è¿”å›æ¡ˆä»¶åˆ—è¡¨

**é¢„æœŸç»“æœ**ï¼š
- âœ… è¿”å›æ¡ˆä»¶è®°å½•
- âœ… åŒ…å«æ¡ˆå·ã€å§”æ‰˜äººã€æ¡ˆç”±ç­‰å­—æ®µ
- âœ… åŒ…å«è®°å½•é“¾æ¥

---

### æµ‹è¯• 2ï¼š"æˆ‘çš„æ¡ˆä»¶"æŸ¥è¯¢

**ç›®çš„**ï¼šéªŒè¯äººå‘˜å­—æ®µæœç´¢ï¼ˆä½¿ç”¨ open_idï¼‰

**å‰æ**ï¼š
- å½“å‰ç”¨æˆ·åœ¨"æ¡ˆä»¶é¡¹ç›®æ€»åº“"çš„"ä¸»åŠå¾‹å¸ˆ"å­—æ®µä¸­

**æ“ä½œ**ï¼š
1. å‘é€ï¼š`æˆ‘çš„æ¡ˆä»¶`
2. è§‚å¯Ÿç»“æœ

**é¢„æœŸç»“æœ**ï¼š
- âœ… åªè¿”å›å½“å‰ç”¨æˆ·è´Ÿè´£çš„æ¡ˆä»¶
- âœ… æ—¥å¿—æ˜¾ç¤º `Query 'my cases' for user: xxx (open_id: xxx)`

---

### æµ‹è¯• 3ï¼šè¡¨æ ¼åˆ«åè¯†åˆ«

**ç›®çš„**ï¼šéªŒè¯ table_aliases é…ç½®

**æ“ä½œ**ï¼š
1. å‘é€ï¼š`æŸ¥è¯¢é¡¹ç›®`
2. è§‚å¯Ÿæ˜¯å¦è¯†åˆ«ä¸º"æ¡ˆä»¶é¡¹ç›®æ€»åº“"

**é¢„æœŸç»“æœ**ï¼š
- âœ… åˆ«åæ­£ç¡®åŒ¹é…
- âœ… æ—¥å¿—æ˜¾ç¤º `Matched alias: 'é¡¹ç›®' -> 'æ¡ˆä»¶é¡¹ç›®æ€»åº“'`

---

### æµ‹è¯• 4ï¼šæ—¥æœŸèŒƒå›´æŸ¥è¯¢

**ç›®çš„**ï¼šéªŒè¯ search_date_range å·¥å…·

**æ“ä½œ**ï¼š
1. å‘é€ï¼š`ä»Šå¤©å¼€åº­çš„æ¡ˆä»¶`
2. å‘é€ï¼š`æœ¬å‘¨çš„åº­`

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ­£ç¡®è§£ææ—¥æœŸèŒƒå›´
- âœ… è¿”å›å¯¹åº”æ—¥æœŸçš„æ¡ˆä»¶

---

### æµ‹è¯• 5ï¼šå…³é”®è¯æŸ¥è¯¢

**ç›®çš„**ï¼šéªŒè¯ search_keyword å·¥å…·

**æ“ä½œ**ï¼š
1. å‘é€ï¼š`æ‰¾ä¸€ä¸‹å¼ ä¸‰çš„æ¡ˆä»¶`
2. å‘é€ï¼š`æŸ¥è¯¢åˆåŒçº çº·`

**é¢„æœŸç»“æœ**ï¼š
- âœ… è¿”å›åŒ…å«å…³é”®è¯çš„è®°å½•
- âœ… æœç´¢å¤šä¸ªæ–‡æœ¬å­—æ®µ

---

### æµ‹è¯• 6ï¼šé—²èŠä¸è¾¹ç•Œ

**ç›®çš„**ï¼šéªŒè¯ ChitchatSkill

**æ“ä½œ**ï¼š
1. å‘é€ï¼š`ä½ å¥½`
2. å‘é€ï¼š`è¿™ä¸ªæ¡ˆå­èƒ½èµ¢å—ï¼Ÿ`
3. å‘é€ï¼š`ä½ èƒ½åšä»€ä¹ˆï¼Ÿ`

**é¢„æœŸç»“æœ**ï¼š
- âœ… å‹å¥½å›åº”é—®å€™
- âœ… æ‹’ç»é¢„æµ‹æ¡ˆä»¶ç»“æœ
- âœ… å±•ç¤ºåŠŸèƒ½åˆ—è¡¨

---

### æµ‹è¯• 7ï¼šæé†’åŠŸèƒ½

**ç›®çš„**ï¼šéªŒè¯ ReminderSkill

**æ“ä½œ**ï¼š
1. å‘é€ï¼š`æé†’æˆ‘æ˜å¤©å¼€åº­`
2. å‘é€ï¼š`æˆ‘çš„æé†’`
3. å‘é€ï¼š`åˆ é™¤æé†’ 1`

**é¢„æœŸç»“æœ**ï¼š
- âœ… åˆ›å»ºæé†’æˆåŠŸ
- âœ… åˆ—å‡ºæ‰€æœ‰æé†’
- âœ… åˆ é™¤æé†’æˆåŠŸ

---

### æµ‹è¯• 8ï¼šé”™è¯¯å¤„ç†

**ç›®çš„**ï¼šéªŒè¯é”™è¯¯æç¤º

**æ“ä½œ**ï¼š
1. å‘é€ï¼š`æŸ¥è¯¢ä¸å­˜åœ¨çš„è¡¨æ ¼`
2. å‘é€ä¸€æ®µæ— æ„ä¹‰çš„é•¿æ–‡æœ¬

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- âœ… æä¾›å»ºè®®æˆ–å¼•å¯¼

---

## ğŸ”§ API æµ‹è¯•å‘½ä»¤

### MCP Server æµ‹è¯•

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8081/health

# å·¥å…·åˆ—è¡¨
curl http://localhost:8081/mcp/tools

# è¡¨æ ¼å­—æ®µ
curl http://localhost:8081/bitable/fields

# åˆ—å‡ºè¡¨æ ¼
curl -X POST http://localhost:8081/mcp/tools/feishu.v1.bitable.list_tables \
  -H "Content-Type: application/json" \
  -d "{\"params\": {}}"

# å…³é”®è¯æœç´¢
curl -X POST http://localhost:8081/mcp/tools/feishu.v1.bitable.search_keyword \
  -H "Content-Type: application/json" \
  -d "{\"params\": {\"keyword\": \"å¼ ä¸‰\"}}"

# äººå‘˜å­—æ®µæœç´¢
curl -X POST http://localhost:8081/mcp/tools/feishu.v1.bitable.search_person \
  -H "Content-Type: application/json" \
  -d "{\"params\": {\"field\": \"ä¸»åŠå¾‹å¸ˆ\", \"open_id\": \"ou_xxx\"}}"

# æ—¥æœŸèŒƒå›´æœç´¢
curl -X POST http://localhost:8081/mcp/tools/feishu.v1.bitable.search_date_range \
  -H "Content-Type: application/json" \
  -d "{\"params\": {\"field\": \"å¼€åº­æ—¥\", \"date_from\": \"2026-02-06\", \"date_to\": \"2026-02-06\"}}"
```

### Feishu Agent æµ‹è¯•

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# æŒ‡æ ‡
curl http://localhost:8080/metrics

# æ¨¡æ‹Ÿ Webhookï¼ˆéœ€è¦æ­£ç¡®çš„éªŒç­¾ï¼‰
# å»ºè®®ä½¿ç”¨é£ä¹¦å®˜æ–¹æµ‹è¯•å·¥å…·
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

**æ£€æŸ¥é¡¹**ï¼š
- Python ç‰ˆæœ¬ï¼ˆéœ€è¦ 3.10+ï¼‰
- ä¾èµ–æ˜¯å¦å®‰è£…ï¼š`pip install -r requirements.txt`
- `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨

### é—®é¢˜ 2ï¼šæŸ¥è¯¢è¿”å›ç©º

**æ£€æŸ¥é¡¹**ï¼š
- è¡¨æ ¼ ID æ˜¯å¦æ­£ç¡®
- View ID æ˜¯å¦æœ‰æ•ˆï¼ˆå»ºè®®æ¸…ç©ºï¼‰
- å­—æ®µåæ˜¯å¦åŒ¹é…

### é—®é¢˜ 3ï¼š403 Forbidden

**æ£€æŸ¥é¡¹**ï¼š
- åº”ç”¨æƒé™æ˜¯å¦é…ç½®
- App Token æ˜¯å¦æ­£ç¡®
- å‡­è¯æ˜¯å¦è¿‡æœŸ

### é—®é¢˜ 4ï¼š"æˆ‘çš„æ¡ˆä»¶"æ— ç»“æœ

**æ£€æŸ¥é¡¹**ï¼š
- å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨"ä¸»åŠå¾‹å¸ˆ"å­—æ®µä¸­
- äººå‘˜å­—æ®µç±»å‹æ˜¯å¦ä¸º 11
- open_id æ˜¯å¦æ­£ç¡®ä¼ é€’

---

## ğŸ“Š æ—¥å¿—å…³é”®è¯

```bash
# æŸ¥çœ‹æ„å›¾è§£æ
grep "Intent parsed" logs/feishu-agent.log

# æŸ¥çœ‹æŠ€èƒ½æ‰§è¡Œ
grep "Skill executed" logs/feishu-agent.log

# æŸ¥çœ‹ MCP è°ƒç”¨
grep "MCP tool" logs/feishu-agent.log

# æŸ¥çœ‹é”™è¯¯
grep -i error logs/feishu-agent.log
```