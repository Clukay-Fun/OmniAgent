# OmniAgent

æ™ºèƒ½ Agent ç³»ç»Ÿï¼Œé¢å‘å¾‹å¸ˆäº‹åŠ¡æ‰€åœºæ™¯ï¼Œå…·å¤‡ **Skill æŠ€èƒ½ç³»ç»Ÿ**ã€**Soul äººæ ¼ç³»ç»Ÿ**ã€**Memory è®°å¿†ç³»ç»Ÿ**ï¼Œå¹¶ä¸é£ä¹¦æ·±åº¦é›†æˆã€‚

## é¡¹ç›®ç›®æ ‡

- æ„å»ºç±»ä¼¼ OpenClaw çš„æ™ºèƒ½ Agent æ¡†æ¶
- æ”¯æŒæŠ€èƒ½æ’ä»¶åŒ–ã€äººæ ¼å®šåˆ¶ä¸æŒä¹…è®°å¿†
- ä½œä¸ºå¾‹å¸ˆäº‹åŠ¡æ‰€æ™ºèƒ½åŠ©æ‰‹æœåŠ¡é£ä¹¦ç§èŠ

## æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **Skill æŠ€èƒ½ç³»ç»Ÿ** | è§„åˆ™ä¼˜å…ˆ + LLM å…œåº•ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ |
| **Soul äººæ ¼ç³»ç»Ÿ** | `SOUL.md` + `IDENTITY.md`ï¼Œ60s çƒ­æ›´æ–° |
| **Memory è®°å¿†ç³»ç»Ÿ** | åˆ†å±‚è®°å¿†ï¼ˆå…±äº« + ç”¨æˆ·éš”ç¦»ï¼‰ï¼Œè‡ªåŠ¨è£å‰ª |
| **é£ä¹¦é›†æˆ** | Webhook æ¥å…¥ + MCP å·¥å…·è®¿é—®å¤šç»´è¡¨æ ¼ |
| **æé†’ç³»ç»Ÿ** | Phase 1 å­˜å–ï¼ŒPhase 2 å®šæ—¶æ¨é€ |

---

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ· (é£ä¹¦)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            Feishu Webhook                                    â”‚
â”‚                         (æ¥æ”¶æ¶ˆæ¯ / å‘é€å›å¤)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AGENT å®¹å™¨                                      â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                           Soul äººæ ¼ç³»ç»Ÿ                               â”‚   â”‚
â”‚  â”‚                    SOUL.md + IDENTITY.md (60s çƒ­æ›´æ–°)                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Memory è®°å¿†ç³»ç»Ÿ                               â”‚   â”‚
â”‚  â”‚           å…±äº«è®°å¿† (MEMORY.md) + ç”¨æˆ·è®°å¿† (users/{id}/)               â”‚   â”‚
â”‚  â”‚                    2å¤©ä¸Šä¸‹æ–‡ + 2000 token è£å‰ª                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Skill Manager                                 â”‚   â”‚
â”‚  â”‚   IntentParser â”€â”€â–¶ SkillRouter â”€â”€â–¶ SkillChain (max_hops=2)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  QuerySkill â”‚ SummarySkill â”‚ ReminderSkill â”‚ ChitchatSkill           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                   â”‚                   â”‚
            â–¼                   â–¼                   â–¼
     MCP Server           LLM Client           PostgreSQL
   (feishu.bitable)                           (reminders)
```

## è¯·æ±‚æµç¨‹ç¤ºä¾‹

```
ç”¨æˆ·: "å¸®æˆ‘æ€»ç»“ä»Šå¤©å¼€åº­çš„æ¡ˆå­"
           â”‚
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Soul æ³¨å…¥    â”‚ â† è¯»å– SOUL.md + IDENTITY.md
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Memory åŠ è½½   â”‚ â† è¯»å–å…±äº«è®°å¿† + ç”¨æˆ·è®°å¿† + æœ€è¿‘ 2 å¤©æ—¥å¿—
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ IntentParser  â”‚ â† è§„åˆ™å‘½ä¸­: Query(0.85) + Summary(0.80)
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SkillChain    â”‚ â† [QuerySkill, SummarySkill]
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ QuerySkill    â”‚ â† è°ƒç”¨ MCPï¼Œå†™å…¥ context.last_result
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SummarySkill  â”‚ â† è°ƒç”¨ LLM ç”Ÿæˆæ‘˜è¦
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Memory å†™å…¥   â”‚ â† è®°å½•åˆ°æ¯æ—¥æ—¥å¿—
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è¿”å›é£ä¹¦      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç›®å½•ç»“æ„

```
OmniAgent/
â”œâ”€â”€ agent/feishu-agent/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ orchestrator.py
â”‚   â”‚   â”‚   â”œâ”€â”€ soul/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ soul.py
â”‚   â”‚   â”‚   â”œâ”€â”€ memory/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ manager.py
â”‚   â”‚   â”‚   â”œâ”€â”€ intent/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ parser.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ rules.py
â”‚   â”‚   â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ router.py
â”‚   â”‚   â”‚   â””â”€â”€ skills/
â”‚   â”‚   â”‚       â”œâ”€â”€ base.py
â”‚   â”‚   â”‚       â”œâ”€â”€ query.py
â”‚   â”‚   â”‚       â”œâ”€â”€ summary.py
â”‚   â”‚   â”‚       â”œâ”€â”€ reminder.py
â”‚   â”‚   â”‚       â””â”€â”€ chitchat.py
â”‚   â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”œâ”€â”€ mcp/
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”œâ”€â”€ workspace/
â”‚   â”‚   â”œâ”€â”€ SOUL.md
â”‚   â”‚   â”œâ”€â”€ IDENTITY.md
â”‚   â”‚   â”œâ”€â”€ MEMORY.md
â”‚   â”‚   â””â”€â”€ users/{open_id}/
â”‚   â”‚       â”œâ”€â”€ memory.md
â”‚   â”‚       â””â”€â”€ daily/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ skills.yaml
â”‚   â”‚   â””â”€â”€ prompts.yaml
â”‚   â””â”€â”€ tests/
â”œâ”€â”€ mcp/mcp-feishu-server/
â”œâ”€â”€ docs/
â”œâ”€â”€ DEV_PLAN.md
â”œâ”€â”€ TASK.md
â””â”€â”€ docker-compose.yml
```

---

## æ ¸å¿ƒæ¥å£

```python
@dataclass
class IntentResult:
    top_skills: List[SkillMatch]
    is_chain: bool = False
    requires_llm_confirm: bool = False

@dataclass
class SkillResult:
    success: bool
    data: Any = None
    message: str = ""
    next_skill: Optional[str] = None
    confidence: Optional[float] = None
    citations: Optional[List[str]] = None

@dataclass
class Context:
    user_id: str
    message: str
    soul_prompt: str
    shared_memory: str
    user_memory: str
    recent_logs: str
    last_result: Optional[Any] = None
    last_skill: Optional[str] = None
```

---

## Workspace

- `agent/feishu-agent/workspace/SOUL.md`ï¼šäººæ ¼å‡†åˆ™
- `agent/feishu-agent/workspace/IDENTITY.md`ï¼šå¯¹å¤–èº«ä»½
- `agent/feishu-agent/workspace/MEMORY.md`ï¼šå›¢é˜Ÿå…±äº«è®°å¿†
- `agent/feishu-agent/workspace/users/{open_id}/`ï¼šç”¨æˆ·éš”ç¦»è®°å¿†

é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åˆ›å»ºä¸Šè¿°æ–‡ä»¶ä¸ç›®å½•ã€‚

---

## é…ç½®æ–‡ä»¶

### skills.yaml

```yaml
intent:
  thresholds:
    direct_execute: 0.7
    llm_confirm: 0.4
  llm_timeout: 10

query:
  keywords: [æŸ¥, æ‰¾, æœç´¢, æ¡ˆä»¶, å¼€åº­]

summary:
  keywords: [æ€»ç»“, æ±‡æ€», æ¦‚æ‹¬]
  default_fields: [æ¡ˆå·, æ¡ˆç”±, å½“äº‹äºº, å¼€åº­æ—¥, ä¸»åŠå¾‹å¸ˆ]

reminder:
  keywords: [æé†’, è®°å¾—, åˆ«å¿˜äº†]

chain:
  triggers:
    - pattern: "(æŸ¥|æ‰¾).*(æ€»ç»“|æ±‡æ€»)"
      skills: [QuerySkill, SummarySkill]
  max_hops: 2
```

### prompts.yaml

```yaml
intent_parser:
  system: |
    ä½ æ˜¯ä¸€ä¸ªæ„å›¾åˆ†ç±»å™¨ã€‚æ ¹æ®ç”¨æˆ·è¾“å…¥ï¼Œåˆ¤æ–­æœ€åŒ¹é…çš„æŠ€èƒ½ã€‚

summary:
  system: |
    ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å¾‹å¸ˆåŠ©ç†ã€‚è¯·æ ¹æ®ä»¥ä¸‹æ¡ˆä»¶æŸ¥è¯¢ç»“æœï¼Œç”Ÿæˆç®€æ´çš„æ‘˜è¦ã€‚
```

---

## å¼€å‘é˜¶æ®µ

| é˜¶æ®µ | å†…å®¹ | çŠ¶æ€ |
|------|------|------|
| Phase 1 | åŸºç¡€æ¡†æ¶ | ğŸ”„ è¿›è¡Œä¸­ |
| Phase 2 | Soul äººæ ¼ç³»ç»Ÿ | â³ å¾…å¼€å§‹ |
| Phase 3 | Memory è®°å¿†ç³»ç»Ÿ | â³ å¾…å¼€å§‹ |
| Phase 4 | Skill ç³»ç»Ÿå®Œå–„ | â³ å¾…å¼€å§‹ |
| Phase 5 | é›†æˆä¸ç¼–æ’ | â³ å¾…å¼€å§‹ |
| Phase 6 | æµ‹è¯•ä¸ç›‘æ§ | â³ å¾…å¼€å§‹ |

è¯¦ç»†ä»»åŠ¡è¿›åº¦è§ `TASK.md`ã€‚

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.11+
- PostgreSQL 14+ï¼ˆReminder éœ€è¦ï¼‰
- é£ä¹¦å¼€æ”¾å¹³å°åº”ç”¨ï¼ˆæœºå™¨äººèƒ½åŠ›ï¼‰

### å¯åŠ¨ MCP Server

```bash
cd mcp/mcp-feishu-server
pip install -r requirements.txt
uvicorn src.main:app --port 8081
```

### å¯åŠ¨ Feishu Agent

```bash
cd agent/feishu-agent
pip install -r requirements.txt
uvicorn src.main:app --port 8080
```

---

## æ•°æ®åº“

```sql
CREATE TABLE reminders (
    id              SERIAL PRIMARY KEY,
    user_id         VARCHAR(64) NOT NULL,
    content         TEXT NOT NULL,
    due_at          TIMESTAMP,
    priority        VARCHAR(16) DEFAULT 'medium',
    status          VARCHAR(16) DEFAULT 'pending',
    created_at      TIMESTAMP DEFAULT NOW()
);
```
